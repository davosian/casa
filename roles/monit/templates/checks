# Monit Manual (hard to find on google):
# https://mmonit.com/monit/documentation/monit.html

CHECK HOST google.com WITH ADDRESS google.com
    if failed ping then alert

CHECK PROGRAM backups WITH PATH {{monit_custom_checks_dir}}/backups-check.sh EVERY 2 CYCLES
   if status != 0 then alert

CHECK HOST home-assistant WITH ADDRESS 0.0.0.0
    if failed port 8123 then alert

CHECK HOST HADashboard WITH ADDRESS 0.0.0.0
    if failed port 5050 then alert

CHECK HOST redis WITH ADDRESS 127.0.0.1
    if failed port 6379 then alert

CHECK HOST roofcam WITH ADDRESS 0.0.0.0
    start program = "/bin/systemctl start {{roofcam_service}}"
    stop program  = "/bin/systemctl stop {{roofcam_service}}"
    if failed port {{roofcam_port}} for 3 cycles then restart

# sonos-http-api tends to crash if connectivity to the sonos devices goes down for a while
# Let's fix this by automatically restarting the service
CHECK HOST sonos-http-api WITH ADDRESS 0.0.0.0
    start program = "/bin/systemctl start {{sonos_http_api_service}}"
    stop program  = "/bin/systemctl stop {{sonos_http_api_service}}"
    if failed port {{sonos_http_api_port}} for 3 cycles then restart

CHECK PROCESS monit-hass-sensors MATCHING monit-hass-sensors
    start program = "/bin/systemctl start {{monit_hass_sensors_service}}"
    stop program  = "/bin/systemctl stop {{monit_hass_sensors_service}}"